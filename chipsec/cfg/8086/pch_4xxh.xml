<?xml version="1.0"?>
<configuration platform="PCH_4XXH">
<!-- XML configuration file 4xxH PCH 620855 -->
<!--
CHIPSEC: Platform Security Assessment Framework
Copyright (c) 2019-2020, Intel Corporation

This program is free software; you can redistribute it and/or
modify it under the terms of the GNU General Public License
as published by the Free Software Foundation; Version 2.

This program is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
GNU General Public License for more details.

You should have received a copy of the GNU General Public License
along with this program; if not, write to the Free Software
Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.

Contact information:
chipsec@intel.com
-->

  <!-- #################################### -->
  <!--                                      -->
  <!-- Information                          -->
  <!--                                      -->
  <!-- #################################### -->
  <info>
    <sku did="0x068D" name="HM470" code="PCH_4xxH" longname="400 series PCH (CML-H) HM470" />
    <sku did="0x068E" name="QM490" code="PCH_4xxH" longname="400 series PCH (CML-H) QM490" />
    <sku did="0x069A" name="H420E" code="PCH_4xxH" longname="400 series PCH (CML-H) H420E" />
  </info>

  <!-- #################################### -->
  <!--                                      -->
  <!-- Integrated devices                   -->
  <!--                                      -->
  <!-- #################################### -->
  <pci>
  </pci>

  <!-- #################################### -->
  <!--                                      -->
  <!-- Memory Mapped I/O spaces (MMIO BARs) -->
  <!--                                      -->
  <!-- #################################### -->
  <mmio>
  </mmio>

  <!-- #################################### -->
  <!--                                      -->
  <!-- I/O spaces (I/O BARs)                -->
  <!--                                      -->
  <!-- #################################### -->
  <io>
  </io>

  <!-- #################################### -->
  <!--                                      -->
  <!-- Memory ranges                        -->
  <!--                                      -->
  <!-- #################################### -->
  <memory>
  </memory>

  <!-- #################################### -->
  <!--                                      -->
  <!-- Configuration registers              -->
  <!--                                      -->
  <!-- #################################### -->
  <registers>

    <!-- ~~~~~~~~~~~~~~~~~~~~~~~~~~~~ -->
    <!-- PCIe Configuration registers -->
    <!-- ~~~~~~~~~~~~~~~~~~~~~~~~~~~~ -->

    <!-- Sideband Register Access Registers -->
    <register name="SBREG_BAR" type="pcicfg" bus="0" dev="0x1F" fun="1" offset="0x10" size="4" desc="Sideband Register Access BAR">
      <field name="RBA" bit="24" size="8" desc="Register Base Address"/>
    </register>

    <register name="P2SBC" type="pcicfg" bus="0" dev="0x1F" fun="1" offset="0xE0" size="4" desc="P2SB Configuration Register">
      <field name="HIDE" bit="8" size="1" desc="Hide SBREG_BAR"/>
    </register>

    <register name="P2SB_HIDE" type="pcicfg" bus="0" dev="0x1F" fun="1" offset="0xE1" size="1" desc="P2SB Configuration Register hide-unhide">
      <field name="HIDE" bit="0" size="1" desc="Hide SBREG_BAR"/>
    </register>

    <!-- Power Management Controller -->
    <register name="ABASE" type="pcicfg" bus="0" dev="0x1f" fun="2" offset="0x20" size="4" desc="ACPI Base Address">
      <field name="STYPE" bit="0" size="1" desc="Space Type (always 1 - I/O space)"/>
      <field name="BA"    bit="7" size="25" desc="Base Address"/>
    </register>
    <register name="PWRMBASE" type="pcicfg" bus="0" dev="0x1f" fun="2" offset="0x10" size="8" desc="PM Base Address">
      <field name="STYPE" bit="0"  size="1"  desc="Space Type (always 0 - memory space)"/>
      <field name="BA"    bit="13" size="51" desc="Base Address"/>
    </register>
    <register name="GEN_PMCON_1" type="mmio" bar="PWRMBASE" offset="0x1020" size="4" desc="General PM Configuration B" />
    <register name="GEN_PMCON_2" type="mmio" bar="PWRMBASE" offset="0x1024" size="4" desc="General PM Configuration B">
      <field name="SMI_LOCK"        bit="4"  size="1" />
    </register>
    <register name="PM_CFG" type="mmio" bar="PWRMBASE" offset="0x1818" size="4" desc="Power Management Configuration Reg 1">
    </register>

    <register name="ACTL" type="mmio" bar="PWRMBASE" offset="0x1BD8" size="4" desc="ACPI Control">
      <field name="SCIS"    bit="0" size="2" desc="SCI IRQ Select"/>
    </register>

    <!-- SMBus Host Controller -->


    <!-- SPI Interface Controller -->
    <register name="BC" type="pcicfg" bus="0" dev="0x1F" fun="5" offset="0xDC" size="4" desc="BIOS Control">
      <field name="BIOSWE"   bit="0" size="1" desc="BIOS Write Enable" />
      <field name="BLE"      bit="1" size="1" desc="BIOS Lock Enable" />
      <field name="SRC"      bit="2" size="2" desc="SPI Read Configuration" />
      <field name="TSS"      bit="4" size="1" desc="Top Swap Status" />
      <field name="SMM_BWP"  bit="5" size="1" desc="SMM BIOS Write Protection" />
      <field name="BBS"      bit="6" size="1" desc="Boot BIOS Strap" />
      <field name="BILD"     bit="7" size="1" desc="BIOS Interface Lock Down"/>
      <field name="OSFH"     bit="9" size="1" desc="OS Function Hide"/>
      <field name="SPI_ASYNC_SS" bit="10" size="1" desc="Asynchronous SMI Status "/>
      <field name="ASE_BWP"  bit="11" size="1" desc="Async SMI Enable for BIOS Write Protection"/>
    </register>

    <!-- ~~~~~~~~~~~~~~~~~~~~~~~~~~~~ -->
    <!-- MMIO registers               -->
    <!-- ~~~~~~~~~~~~~~~~~~~~~~~~~~~~ -->

    <!-- PCH SPIBAR registers -->
   <register name="BFPR" type="mmio" bar="SPIBAR" offset="0x00" size="4" desc="BIOS Flash Primary Region Register (= FREG1)">
      <field name="PRB"  bit="0"  size="15" desc="BIOS Flash Primary Region Base"/>
      <field name="PRL"  bit="16" size="15" desc="BIOS Flash Primary Region Limit"/>
    </register>

    <!-- PCH RTC registers -->

    <!-- ~~~~~~~~~~~~~~~~~~~~~~~~~~~~ -->
    <!-- I/O registers (I/O ports)    -->
    <!-- ~~~~~~~~~~~~~~~~~~~~~~~~~~~~ -->

    <!-- PCH TCOBASE (SMBus TCO) I/O registers -->

    <!-- ~~~~~~~~~~~~~~~~~~~~~~~~~~~~ -->
    <!--      Undefined Registers     -->
    <!-- ~~~~~~~~~~~~~~~~~~~~~~~~~~~~ -->
    <register name="GC" undef="Not defined for platform" />

  </registers>


  <!-- #################################### -->
  <!--                                      -->
  <!-- 'Controls'                           -->
  <!--                                      -->
  <!-- #################################### -->
  <controls>
    <control name="BiosInterfaceLockDown"  register="BC"          field="BILD"      desc="BIOS Interface Lock-Down"/>
    <control name="TopSwap"                register="BC"          field="TSS"       desc="Top Swap Status"/>
    <control name="SpiWriteStatusDis"      register="HSFS"        field="WRSDIS"    desc="Write Status Disable"/>
    <control name="SMILock"                register="GEN_PMCON_2" field="SMI_LOCK"  desc="SMI Global Configuration Lock"/>
    <control name="TcoCtlLock"            register="TCOCTL" field="TCO_BASE_LOCK"  desc="TCO Base Lock"/>
  </controls>

</configuration>